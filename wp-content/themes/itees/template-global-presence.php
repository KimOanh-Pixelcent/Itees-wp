<?php 	/*	** Template name: Global presence template	*/	get_header(); 	?><link rel="stylesheet" id="genericons-css" href="https://itees.vinova.sg/wp-content/themes/itees/assets-gobal/dangpx_files/genericons.css" type="text/css" media="all"><script type="text/javascript" src="https://itees.vinova.sg/wp-content/themes/itees/assets-gobal/dangpx_files/jquery.js"></script><script type="text/javascript" src="https://itees.vinova.sg/wp-content/themes/itees/assets-gobal/dangpx_files/jquery-migrate.min.js"></script><link rel="stylesheet" href="https://itees.vinova.sg/wp-content/themes/itees/assets-gobal/dangpx_files/colorbox.css"><link rel="stylesheet" href="https://itees.vinova.sg/wp-content/themes/itees/assets-gobal/dangpx_files/earthviewer_styles_unique.min.css"><script src="https://itees.vinova.sg/wp-content/themes/itees/assets-gobal/dangpx_files/jquery.min.js"></script><script src="https://itees.vinova.sg/wp-content/themes/itees/assets-gobal/dangpx_files/globe.min.js"></script><div>						<div class="container-fluid pb-5 global-top pt-5">			<div class="row pt-sm-5 pt-3">				<div class="col-lg-3 col-md-3 col-12">				</div>				<div class="col-lg-9 col-md-9 col-12 global-list">				<?php if ( !wp_is_mobile() ) { ?>					<div class="globe-pic" style="width: 36vw;">						<div id="globeGl_" class="globeGl"> </div>						<?php $all_country = get_terms( array('taxonomy' => 'country','orderby' => 'name','order' => 'ASC','hide_empty' => true) ); ?>						<?php if(!empty($all_country)){ ?>							<?php foreach($all_country as $row){ ?>							<?php $term = 'term_'.$row->term_id;  ?>								<?php $postlist = get_posts(array('post_type' => 'projects','orderby' => 'ID','order' => 'ASC','tax_query' => array(array('taxonomy' => 'country','field' => 'term_id','posts_per_page' => 1,'terms' => $row->term_id)))); ?>																<div class="hotspot h5g_hidden" data-lat="<?php echo get_field('lat', $term); ?>" data-long="<?php echo get_field('long', $term); ?>" data-url="<?php echo get_the_permalink($postlist[0]->ID);?>"><?php echo $row->name;?></div>  							<?php } ?>						<?php } ?>					</div>				<?php } ?>					<h1 class="global-header h2 size-55 k-main-color"><?php echo get_the_title(); ?></h1>					<div class="container-fluid global-bg-red">						<?php echo get_field('global_info'); ?>						<?php if (wp_is_mobile() ) { ?>						<div class="globe-pic-second">							<div id="globeGl_" class="globeGl"> </div>							<?php $all_country = get_terms( array('taxonomy' => 'country','orderby' => 'name','order' => 'ASC','hide_empty' => true) ); ?>							<?php if(!empty($all_country)){ ?>								<?php foreach($all_country as $row){ ?>								<?php $term = 'term_'.$row->term_id;  ?>									<?php $postlist = get_posts(array('post_type' => 'projects','orderby' => 'ID','order' => 'ASC','tax_query' => array(array('taxonomy' => 'country','field' => 'term_id','posts_per_page' => 1,'terms' => $row->term_id)))); ?>																	<div class="hotspot h5g_hidden" data-lat="<?php echo get_field('lat', $term); ?>" data-long="<?php echo get_field('long', $term); ?>" data-url="<?php echo get_the_permalink($postlist[0]->ID);?>"><?php echo $row->name;?></div>  								<?php } ?>							<?php } ?>						</div>						<?php } ?>					</div>				<style>				#carouselExampleControls{min-height:200px;}				 </style>										<div class="container global-carousel-cont">						<div id="carouselExampleControls" class="carousel slide global-carousel" data-interval="false" data-ride="carousel">							<div class="carousel-inner">								<?php 								$prj_locations = get_field('projects_locations');								if($prj_locations):									$first_location = $prj_locations[0];									$second_location = $prj_locations[1];									$third_location = $prj_locations[2];									?>									<div class="carousel-item active" align="center">										<div class="d-block w-100">											<p class="global-location"><?php echo $first_location['region'];  ?></p>											<div class="row flag-tb">												<?php												$flags = $first_location['country'];												if($flags) {													foreach($flags as $flag) {														echo '<img class="global-flag" src="';														echo $flag['flag']['url'];														echo '">';													}												}												?>											</div>										</div>									</div>									<div class="carousel-item" align="center">										<div class="d-block w-100">											<p class="global-location"><?php echo $second_location['region']; ?></p>											<div class="row flag-tb">												<?php												$flags = $second_location['country'];												if($flags) {													foreach($flags as $flag) {														echo '<img class="global-flag" src="';														echo $flag['flag']['url'];														echo '">';													}												}												?>											</div>										</div>									</div>									<div class="carousel-item" align="center">										<div class="d-block w-100">											<p class="global-location"><?php echo $third_location['region']; ?></p>											<div class="row flag-tb">												<?php												$flags = $third_location['country'];												if($flags) {													foreach($flags as $flag) {														echo '<img class="global-flag" src="';														echo $flag['flag']['url'];														echo '">';													}												}												?>											</div>										</div>									</div>								<?php	endif; 								?>							</div>							<a class="carousel-control-prev global-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">								<span class="carousel-control-prev-icon global-prev-icon" aria-hidden="true"></span>								<span class="sr-only">Previous</span>							</a>							<a class="carousel-control-next global-control-next" href="#carouselExampleControls" role="button" data-slide="next">								<span class="carousel-control-next-icon global-next-icon" aria-hidden="true"></span>								<span class="sr-only">Next</span>							</a>						</div>					</div>				</div>			</div>				</div><script src='<?php echo site_url(); ?>/wp-content/themes/itees/assets/js/jquery.mousewheel.min.js'></script><script src='<?php echo site_url(); ?>/wp-content/themes/itees/assets/js/TweenMax.min.js'></script><script src='<?php echo site_url(); ?>/wp-content/themes/itees/assets/js/ScrollToPlugin.min.js'></script><script src='<?php echo site_url(); ?>/wp-content/themes/itees/assets/js/scrollpane.js'></script> <script>	var g = $("div#globeGl_").globe({		globeRadius:{val:180},		globeShine:{val:3},		globeTexture:{val:"https://itees.vinova.sg/wp-content/themes/itees/assets-gobal/img/Earthe2-big.jpg"},		globeBump:{val:"https://itees.vinova.sg/wp-content/themes/itees/assets-gobal/img/earthbump1k.jpg"},		globeMinScale:{val:0.5},		globeMaxScale:{val:0.5},		globeSegments:{val:50},		momentum:{val:0.2},		ambientIntensity:{val:1.5},		ambientColor:{val:"#555584"},		ambientPosX:{val:-5000},		ambientPosY:{val:-15000},		ambientPosZ:{val:-15000},		headLampIntensity:{val:0.8},		headLampColor:{val:"#ffffff"},		headLampPosX:{val:500},		headLampPosY:{val:1000},		headLampPosZ:{val:0},		hotSpotIcon:{val:"https://itees.vinova.sg/wp-content/themes/itees/assets-gobal/dangpx_files/images/marker.png"},		hotSpotsubIcon:{val:"https://itees.vinova.sg/wp-content/themes/itees/assets-gobal/dangpx_files/images/marker.png"},		backPlateTexture:{val:"https://itees.vinova.sg/wp-content/themes/itees/assets-gobal/img/backPlate_glow.png"},		backPlateMargin:{val:30},		debugMode:{val:false},		popWidth:{val:"100%"},		popHeight:{val:"100%"},		contentClass:{val:".hotspot"},		hotspotCssOverride:{val:"hotspot_override"},		cameraTargetX:{val:0},		cameraTargetY:{val:0},		cameraTargetZ:{val:0},		autoRotateSpeed:{val:0.002},		autoRotate:{val:true},		clickExternal:{val:true},		assetPath:{val:""},		zoomWheelDirection:{val:"downOut"},		onlyOrbitOnGlobe:{val:true},		allowUserZoom:{val:false},	});		$("#globeGl_").on('mouseenter touchstart', function() {		$("#globeGl_").globe('stopAutoRotate');	}) 	$("#globeGl_").on('mouseleave touchend', function() {		$("#globeGl_").globe('startAutoRotate');	})	</script> <script type="text/javascript" src="<?php echo site_url(); ?>/wp-content/themes/itees/assets-gobal/dangpx_files/imagesloaded.min.js"></script><script type="text/javascript" src="<?php echo site_url(); ?>/wp-content/themes/itees/assets-gobal/dangpx_files/masonry.min.js"></script><script type="text/javascript" src="<?php echo site_url(); ?>/wp-content/themes/itees/assets-gobal/dangpx_files/jquery.masonry.min.js"></script><script type="text/javascript" src="<?php echo site_url(); ?>/wp-content/themes/itees/assets-gobal/dangpx_files/functions.js"></script><script type="text/javascript" src="<?php echo site_url(); ?>/wp-content/themes/itees/assets-gobal/dangpx_files/wp-embed.min.js"></script>		<div class="container-fluid pt-3 pb-5 ">			<h2 class="global-title h2 k-main-color size-34"><strong>Our Projects Around The Globe</strong></h2>			<form method="get">			<div class="row">				<div class="col-lg-6 col-md-6 global-menu-region">					<?php						$all_region = get_categories(array('taxonomy' => 'region','orderby' => 'name','show_count' => 0,'pad_counts' => 0,'hierarchical' => 1,'title_li' => '','hide_empty' => 1 ));						if(!empty($all_region)){					?>									<select onchange="this.form.submit()" class="global-dropdown" name="region" id="global-regions">						<option class="global-option" value="all">All regions</option>					  <?php						 foreach($all_region as $ct) { ?> 							<option class="global-option" <?php if(!empty($_GET['region']) && $_GET['region'] == $ct->slug){ ?>selected="selected" <?php } ?> value="<?php echo $ct->slug;?>"><?php echo $ct->name;?></option>						<?php } ?>					</select>					<?php } ?>				</div>				<div class="col-lg-6 col-md-6 global-menu-country">					<?php						$all_country = get_categories(array('taxonomy' => 'country','orderby' => 'name','show_count' => 0,'pad_counts' => 0,'hierarchical' => 1,'title_li' => '','hide_empty' => 1 ));						if(!empty($all_country)){					?>										<select onchange="this.form.submit()" class="global-dropdown" name="country" id="global-country">						<option class="global-option" value="all">All countries</option>					  <?php						 foreach($all_country as $ct) { ?> 							<option class="global-option" <?php if(!empty($_GET['country']) && $_GET['country'] == $ct->slug){ ?>selected="selected" <?php } ?> value="<?php echo $ct->slug;?>"><?php echo $ct->name;?></option>						<?php } ?>					</select>					<?php } ?>				</div>			</div>			 </form>			<div class="row global-card-table projects-list" id="list-post" style="justify-content: normal;">				<?php				$region_filter = array();				if(isset($_GET['region']) && !empty($_GET['region']) && $_GET['region'] != 'all'){					$region_filter = array( 'taxonomy' => 'region', 'field' => 'slug', 'terms' => $_GET['region'] );				}									$country_filter = array();				if(isset($_GET['country']) && !empty($_GET['country']) && $_GET['country'] != 'all'){					$country_filter = array( 'taxonomy' => 'country', 'field' => 'slug', 'terms' => $_GET['country'] );				}									$query = new WP_Query(array(					's' => !empty($_GET['keyword'])? $_GET['keyword']:'',					'post_type' => 'projects',					'post_status' => 'publish',					'posts_per_page' =>  6,					'sort_column' => 'menu_order',					'order' => 'ASC',					   'tax_query' => array(						   'relation' => 'AND',						   !empty($region_filter)?$region_filter:'',						   'relation' => 'AND',						   !empty($country_filter)?$country_filter:'',					   ), 				)); 				$countp = $query ->found_posts;					if($query->have_posts()):					while ( $query->have_posts() ) : $query->the_post();						$srcImage = get_the_post_thumbnail_url( get_the_ID(), 'full' ); 						$terms = get_the_terms(get_the_ID(),'category-project' ); ?>						<div class="col-xl-4 col-lg-4 col-sm-6 mb-sm-5 mb-4">							<div class="item mb-sm-0 mb-3">								<a href="<?php the_permalink(); ?>" class="d-block">									<div class="img k-relative">										<div class="bg" style="background-image: url(<?php echo $srcImage; ?>); background-size: cover; background-position: center"></div>										<img src="<?php echo $srcImage; ?>" alt="" class="w-100 fade" height="170px">									</div>									<div class="info">										<div class="size-18 k-wei-600 mb-2">											<span><?php echo get_field('location');?></span>										</div>										<div class="title mb-4"><strong><?php the_title();?></strong></div>										<div class="cat size-18 k-wei-600">											<?php foreach ($terms as $value) {												echo '<u>'.$value->name.'</u><span> • </span>';											} ?>										</div>																		</div>								</a>															</div>						</div>						<?php						endwhile; wp_reset_postdata();					else:						get_template_part( 'template-parts/content', 'none' );					endif; 				?> 				</div>				<?php if ($countp > 6){ ?>					<div align="center" id="fixloadmore">					<a id="loadmore" href="javascript:;" class="k-btn-default k-btn-white" role="button"><strong>Load More</strong></a>				</div>				<?php } ?>			</div>		</div><?php if ($countp > 6){ ?>	<script type="text/javascript">    jQuery(document).ready(function(){        ajaxurl = '<?php echo admin_url("admin-ajax.php")?>'; //Đường dẫn chứa hàm xử lý dữ liệu        offset = 6; // Đặt số lượng bài viết đã hiển thị ban đầu        jQuery( "#fixloadmore" ).click(function() { //Script sẽ chạy khi ấn vào nút Load More đã tạo ở trên            jQuery('#loadmore i').removeClass('hidden'); //Thẻ i sẽ bỏ class hidden, tạo ra 1 spinner quay            jQuery.ajax({                type:"POST", //Phương thưc truyền Post                url:ajaxurl,                data:{"action": "loadmore_project", 'offset':offset},  //Gửi các dữ liệu                success:function(response)                { 					console.log(response);                    if (response != 'end') {                        jQuery('#list-post').append(response);  //Chèn thêm 10 bài viết nữa vào thẻ ID list-post                        offset = offset + 3; //Tăng bài viết đã hiển thị lên                         jQuery('#fixloadmore').html(); // Sau khi load xong 10 bài viết mới sẽ ẩn spinner đi                        if (offset >= <?php echo $countp ?>) {                              jQuery('#loadmore').hide(); //Ẩn button Load more khi không còn bài viết để hiển thị tiếp nếu click                        }else{							jQuery('#fixloadmore').html('<a id="loadmore" href="javascript:;" class="btn btn-white global-btn" role="button"><strong>Load More</strong></a>');						}                    }                }});        });    });</script><?php } ?><?php get_footer('content'); ?>